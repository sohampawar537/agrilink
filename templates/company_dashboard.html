{% extends "base.html" %}

{% block content %}
    <div class="dashboard-header">
        <h2>Welcome, {{ current_user.username }}! (Company)</h2>
    </div>

    <!-- Market Insights -->
    <div class="insights-grid">
        <div class="content-section">
            <h3>üìà Market Price Trends</h3>
            <ul class="price-trends-list">
                {% for item in prices %}
                <li class="price-item">
                    <span class="price-name">{{ item.name }}</span>
                    <span class="price-value">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                    <span class="price-change">{{ item.change }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="content-section">
            <h3>üå¶Ô∏è 5-Day Weather Forecast</h3>
            <ul class="weather-forecast-list">
                {% for item in weather %}
                <li class="weather-item">
                    <span class="weather-day">{{ item.day }}</span>
                    <span class="weather-icon">{{ item.icon }}</span>
                    <span class="weather-temp">{{ item.temp }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Marketplace -->
    <div class="content-section">
        <h3>üöú Available Crops Marketplace</h3>
        
        <!-- Search Bar -->
        <div class="search-bar-container">
            <input type="text" id="search-bar" placeholder="Type to search for crops...">
            <button id="voice-search-btn" title="Search by voice">
                <svg class="icon-mic" id="mic-icon"><use xlink:href="#icon-mic"></use></svg>
            </button>
        </div>

        <div class="crop-list">
            {% for crop in crops %}
                <div class="crop-card">
                    <img src="{{ url_for('static', filename='uploads/' + crop.image_file) }}" alt="{{ crop.name }}" class="crop-card-image">
                    <div class="crop-card-content">
                        <h4>{{ crop.name }}</h4>
                        <p><strong>Farmer:</strong> {{ crop.author.username }}</p>
                        <p><strong>Quantity:</strong> {{ crop.quantity }} Quintals</p>
                        <p><strong>Asking Price:</strong> ‚Çπ{{ "%.2f"|format(crop.price) }} / Quintal</p>
                        <small>Listed on: {{ crop.date_posted.strftime('%Y-%m-%d') }}</small>
                    </div>
                    <div class="crop-card-footer">
                        <a href="{{ url_for('chat', crop_id=crop.id, other_user_id=crop.farmer_id) }}" class="btn-secondary">Contact Farmer</a>
                    </div>
                </div>
            {% else %}
                <p>No crops are currently listed on the marketplace.</p>
            {% endfor %}
        </div>
    </div>
{% endblock %}

