{% extends "base.html" %}

{% block content %}
    <div class="dashboard-header">
        <h2>Welcome, {{ current_user.username }}! (Farmer)</h2>
        <a href="{{ url_for('add_crop') }}" class="btn-primary">Ôºã Add New Crop</a>
    </div>

    <!-- Market Insights -->
    <div class="insights-grid">
        <div class="content-section">
            <h3>üìà Market Price Trends</h3>
            <ul class="price-trends-list">
                {% for item in prices %}
                <li class="price-item">
                    <span class="price-name">{{ item.name }}</span>
                    <span class="price-value">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                    <span class="price-change">{{ item.change }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div class="content-section">
            <h3>üå¶Ô∏è 5-Day Weather Forecast</h3>
            <ul class="weather-forecast-list">
                {% for item in weather %}
                <li class="weather-item">
                    <span class="weather-day">{{ item.day }}</span>
                    <span class="weather-icon">{{ item.icon }}</span>
                    <span class="weather-temp">{{ item.temp }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>

    <!-- Active Negotiations -->
    <div class="content-section">
        <h3>üí¨ Active Negotiations</h3>
        {% if active_chats %}
            <div class="chat-list">
                {% for chat in active_chats %}
                    <a href="{{ url_for('chat', crop_id=chat.crop_id, other_user_id=chat.company_id) }}" class="chat-item">
                        <span>New message from <strong>{{ chat.company_name }}</strong> regarding <strong>{{ chat.crop_name }}</strong></span>
                        <span class="btn-primary">View Chat</span>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <p>You have no new messages from companies.</p>
        {% endif %}
    </div>

    <!-- Farmer's Listed Crops -->
    <div class="content-section">
        <h3>üåæ Your Listed Crops</h3>
        {% if crops %}
            <div class="crop-list">
                {% for crop in crops %}
                    <div class="crop-card">
                        <img src="{{ url_for('static', filename='uploads/' + crop.image_file) }}" alt="{{ crop.name }}" class="crop-card-image">
                        <div class="crop-card-content">
                            <h4>{{ crop.name }}</h4>
                            <p><strong>Quantity:</strong> {{ crop.quantity }} Quintals</p>
                            <p><strong>Asking Price:</strong> ‚Çπ{{ "%.2f"|format(crop.price) }} / Quintal</p>
                            <small>Listed on: {{ crop.date_posted.strftime('%Y-%m-%d') }}</small>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>You have not listed any crops yet. Click "Add New Crop" to get started!</p>
        {% endif %}
    </div>
{% endblock %}

